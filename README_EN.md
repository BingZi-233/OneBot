# OneBot

<div align="center">

![OneBot](https://img.shields.io/badge/OneBot-v11%2Fv12-blue)
![TabooLib](https://img.shields.io/badge/TabooLib-6.2.3+-green)
![Minecraft](https://img.shields.io/badge/Minecraft-1.8--1.21+-orange)
![Java](https://img.shields.io/badge/Java-8+-red)
![Build Status](https://img.shields.io/github/actions/workflow/status/BingZi-233/OneBot/build.yml)
![License](https://img.shields.io/github/license/BingZi-233/OneBot)
![Downloads](https://img.shields.io/github/downloads/BingZi-233/OneBot/total)

A powerful Minecraft server plugin that bridges OneBot protocol implementations with your game server.

[‰∏≠ÊñáÊñáÊ°£](./README.md) | **English** | [Wiki](https://github.com/BingZi-233/OneBot/wiki) | [Issues](https://github.com/BingZi-233/OneBot/issues)

</div>

## ‚ú® Features

- üîå **Protocol Support** - Full support for OneBot v11/v12 protocols
- üéÆ **Wide Compatibility** - Works with Minecraft 1.8-1.21+ servers
- üöÄ **High Performance** - Built on TabooLib framework for optimal performance
- üîß **Easy Configuration** - Pre-configured templates for popular OneBot implementations
- ‚ö° **Fully Async APIs** - All API calls use async callback patterns to prevent main thread blocking
- üìä **Metrics Integration** - Built-in bStats metrics for usage analytics
- üåç **Internationalization** - Multi-language support with i18n
- üîÑ **Real-time Sync** - Bidirectional message forwarding between game and chat platforms
- üé® **Rich Text Support** - Full Minecraft chat component support with formatting

## üìã Requirements

- **Java**: 8 or higher
- **Server**: Bukkit/Spigot/Paper 1.8-1.21+
- **Memory**: Minimum 2GB recommended
- **OneBot Implementation**: Any OneBot v11/v12 compatible server (e.g., go-cqhttp, Lagrange.OneBot)

## üöÄ Quick Start

### Installation

1. **Download the Plugin**
   - Get the latest release from [Releases](https://github.com/BingZi-233/OneBot/releases)
   - Choose the file: `OneBot-x.x.x.jar`

2. **Install on Server**
   ```bash
   # Place the JAR file in your server's plugins directory
   cp OneBot-*.jar /path/to/server/plugins/
   ```

3. **Start/Restart Server**
   ```bash
   # Restart your Minecraft server
   /reload
   # or
   /stop && ./start.sh
   ```

### Configuration

1. **List Available Presets**
   ```bash
   /onebot preset list
   ```

2. **Apply a Preset Configuration**
   ```bash
   # For go-cqhttp
   /onebot preset apply go-cqhttp
   
   # For Lagrange.OneBot
   /onebot preset apply lagrange
   ```

3. **Connect to OneBot Server**
   ```bash
   /onebot connect
   ```

4. **Check Connection Status**
   ```bash
   /onebot status
   ```

## üèóÔ∏è Architecture Design

```
OneBot Plugin Architecture
‚îú‚îÄ‚îÄ üìÅ config/          # Configuration Management
‚îÇ   ‚îî‚îÄ‚îÄ OneBotConfig    # Configuration class with preset and custom config support
‚îú‚îÄ‚îÄ üìÅ client/          # WebSocket Connection
‚îÇ   ‚îî‚îÄ‚îÄ OneBotWebSocketClient  # WebSocket client implementation
‚îú‚îÄ‚îÄ üìÅ event/           # Event System
‚îÇ   ‚îú‚îÄ‚îÄ EventFactory   # Event factory for parsing and dispatching events
‚îÇ   ‚îú‚îÄ‚îÄ base/          # Base event classes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OneBotEvent # Base event class
‚îÇ   ‚îú‚îÄ‚îÄ message/       # Message Event Package
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageEvent        # Message event base class
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateMessageEvent # Private message event
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GroupMessageEvent   # Group message event
‚îÇ   ‚îú‚îÄ‚îÄ notice/        # Notice Event Package
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NoticeEvent         # Notice event base class
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GroupIncreaseNotice # Group member increase notification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GroupDecreaseNotice # Group member decrease notification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GroupBanNotice      # Group ban notification
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FriendAddNotice     # Friend add notification
‚îÇ   ‚îî‚îÄ‚îÄ request/       # Request Event Package
‚îÇ       ‚îú‚îÄ‚îÄ RequestEvent        # Request event base class
‚îÇ       ‚îú‚îÄ‚îÄ FriendRequestEvent  # Friend request event
‚îÇ       ‚îî‚îÄ‚îÄ GroupRequestEvent   # Group request event
‚îú‚îÄ‚îÄ üìÅ action/         # API Calls
‚îÇ   ‚îî‚îÄ‚îÄ ActionFactory  # Async API call factory based on CompletableFuture
‚îú‚îÄ‚îÄ üìÅ api/            # Public Interface
‚îÇ   ‚îî‚îÄ‚îÄ OneBotAPI     # Async callback mode API interface
‚îú‚îÄ‚îÄ üìÅ manager/        # Connection Management
‚îÇ   ‚îî‚îÄ‚îÄ OneBotManager # Lifecycle management
‚îú‚îÄ‚îÄ üìÅ command/        # Command System
‚îÇ   ‚îî‚îÄ‚îÄ OneBotCommand # Management command implementation
‚îî‚îÄ‚îÄ üìÅ example/        # Usage Examples
```

## üíª Development Usage

### Listening to Events

```kotlin
import online.bingzi.onebot.event.message.GroupMessageEvent
import online.bingzi.onebot.event.message.PrivateMessageEvent
import taboolib.common.platform.event.SubscribeEvent

@SubscribeEvent
fun onGroupMessage(event: GroupMessageEvent) {
    when {
        event.message == "hello" -> {
            event.reply("Hello, world!")
        }
        event.message == "ping" -> {
            event.replyWithAt("pong!")
        }
        event.message.startsWith("echo ") -> {
            val content = event.message.removePrefix("echo ")
            event.replyWithQuote("You said: $content")
        }
    }
}

@SubscribeEvent
fun onPrivateMessage(event: PrivateMessageEvent) {
    if (event.message.contains("help")) {
        event.reply("OneBot Plugin v1.0\nSupported commands: ...")
    }
}
```

### Using API

```kotlin
import online.bingzi.onebot.api.OneBotAPI

// Send messages (async callback mode)
OneBotAPI.sendGroupMessage(groupId, "Hello Group!") { success ->
    if (success) {
        println("Group message sent successfully")
    } else {
        println("Failed to send group message")
    }
}

OneBotAPI.sendPrivateMessage(qqNumber, "Hello Private!") { success ->
    if (success) {
        println("Private message sent successfully")
    }
}

// Group management (async callback)
OneBotAPI.banGroupMember(groupId, qqNumber, 600) { success ->
    if (success) {
        println("Ban successful")
    }
} // Ban for 10 minutes

OneBotAPI.kickGroupMember(groupId, qqNumber, true) { success ->
    if (success) {
        println("Kick successful")
    }
} // Kick and reject add requests

// Get information (async callback)
OneBotAPI.getFriendList { friendList ->
    if (friendList != null) {
        println("Friend list: $friendList")
    }
}

OneBotAPI.getGroupList { groupList ->
    if (groupList != null) {
        println("Group list: $groupList") 
    }
}

OneBotAPI.getGroupMemberList(groupId) { memberList ->
    if (memberList != null) {
        println("Group member list: $memberList")
    }
}

// Check connection status
if (OneBotAPI.isConnected()) {
    // Execute operations that require connection
}
```

## üìö Event Types

### Message Events
- `PrivateMessageEvent` - Private message
- `GroupMessageEvent` - Group message

### Notice Events  
- `GroupIncreaseNotice` - Group member increase
- `GroupDecreaseNotice` - Group member decrease
- `GroupBanNotice` - Group ban event
- `FriendAddNotice` - Friend add

### Request Events
- `FriendRequestEvent` - Friend request
- `GroupRequestEvent` - Group request

## üîß Development

### Building from Source

```bash
# Clone the repository
git clone https://github.com/BingZi-233/OneBot.git
cd OneBot

# Build the plugin
./gradlew build

# The output JAR will be in build/libs/
```

### Development Setup

For developers who want to use OneBot as a dependency:

```bash
# Build API JAR (without implementation)
./gradlew taboolibBuildApi -PDeleteCode
```

### Maven Dependency

```xml
<dependency>
    <groupId>online.bingzi</groupId>
    <artifactId>onebot</artifactId>
    <version>VERSION</version>
</dependency>
```

### Gradle Dependency

```kotlin
dependencies {
    implementation("online.bingzi:onebot:VERSION")
}
```

## üåê Supported OneBot Implementations

| Implementation | Protocol Version | Status |
|----------------|------------------|--------|
| go-cqhttp | v11 | ‚úÖ Fully Supported |
| Lagrange.OneBot | v11 | ‚úÖ Fully Supported |
| Shamrock | v11 | ‚úÖ Fully Supported |
| NapCat | v11 | ‚úÖ Fully Supported |
| OneBot v12 | v12 | üöß In Development |

## üìñ Commands

| Command | Permission | Description |
|---------|------------|-------------|
| `/onebot help` | `onebot.use` | Show help information |
| `/onebot status` | `onebot.use` | Check connection status |
| `/onebot connect` | `onebot.admin` | Connect to OneBot server |
| `/onebot disconnect` | `onebot.admin` | Disconnect from OneBot server |
| `/onebot reload` | `onebot.admin` | Reload configuration |
| `/onebot preset list` | `onebot.admin` | List available presets |
| `/onebot preset apply <name>` | `onebot.admin` | Apply a preset configuration |

## üîó Configuration Guide

### Basic Configuration

```yaml
# config.yml
onebot:
  # Connection settings
  connection:
    type: websocket
    host: localhost
    port: 8080
    path: /onebot/v11/ws
    
  # Authentication
  auth:
    enabled: false
    token: your-token-here
    
  # Message forwarding
  forward:
    game-to-bot: true
    bot-to-game: true
    
  # Format settings
  format:
    game-message: "[MC] <{player}> {message}"
    bot-message: "[QQ] <{sender}> {message}"
```

### Advanced Settings

See [Configuration Wiki](https://github.com/BingZi-233/OneBot/wiki/Configuration) for detailed configuration options.

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guidelines](CONTRIBUTING.md) for details.

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## üìä Metrics

This plugin uses bStats to collect anonymous usage data. You can opt-out in the bStats config file.

View our metrics: [bStats Page](https://bstats.org/plugin/bukkit/OneBot)

## üêõ Bug Reports & Feature Requests

- **Bug Reports**: [Create an Issue](https://github.com/BingZi-233/OneBot/issues/new?labels=bug)
- **Feature Requests**: [Request a Feature](https://github.com/BingZi-233/OneBot/issues/new?labels=enhancement)
- **Discussions**: [Join Discussions](https://github.com/BingZi-233/OneBot/discussions)

## üìú License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- [cnlimiter/onebot-client](https://github.com/cnlimiter/onebot-client) - This project is redesigned and reimplemented based on this project
- [TabooLib](https://github.com/TabooLib/taboolib) - The powerful framework this plugin is built on
- [OneBot](https://onebot.dev/) - The chat protocol standard
- All contributors and users of this plugin

## üíñ Support

If you find this plugin helpful, please consider:
- ‚≠ê Starring the repository
- üêõ Reporting bugs and suggesting features
- ü§ù Contributing to the codebase
- üì¢ Sharing with others

---

<div align="center">

**Made with ‚ù§Ô∏è by [BingZi-233](https://github.com/BingZi-233)**

[Report Bug](https://github.com/BingZi-233/OneBot/issues/new?labels=bug) ¬∑ [Request Feature](https://github.com/BingZi-233/OneBot/issues/new?labels=enhancement) ¬∑ [Join Discussion](https://github.com/BingZi-233/OneBot/discussions)

</div>